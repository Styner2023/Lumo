set(LODEPNG_INCLUDE_DIR ${CMAKE_SOURCE_DIR}/3rdparty/lodepng)
set(LODEPNG_LIBRARIES lodepng)
set(LODEPNG_LIB_DIR ${CMAKE_CURRENT_BINARY_DIR})

file(GLOB LODEPNG_SOURCES 
	${LODEPNG_INCLUDE_DIR}/lodepng.cpp
	${LODEPNG_INCLUDE_DIR}/lodepng.h)
source_group(src FILES ${LODEPNG_SOURCES})		
   
if(USE_SHARED_LIBS)
	set(BUILD_SHARED_LIBS ON CACHE BOOL "" FORCE)
	set(LLVM_USE_CRT_DEBUG MDd CACHE STRING "" FORCE)
	set(LLVM_USE_CRT_MINSIZEREL MD CACHE STRING "" FORCE)
	set(LLVM_USE_CRT_RELEASE MD CACHE STRING "" FORCE)
	set(LLVM_USE_CRT_RELWITHDEBINFO MD CACHE STRING "" FORCE)
	set(USE_MSVC_RUNTIME_LIBRARY_DLL ON CACHE BOOL "")
else()
	set(BUILD_SHARED_LIBS OFF CACHE BOOL "" FORCE)
	set(LLVM_USE_CRT_DEBUG MTd CACHE STRING "" FORCE)
	set(LLVM_USE_CRT_MINSIZEREL MT CACHE STRING "" FORCE)
	set(LLVM_USE_CRT_RELEASE MT CACHE STRING "" FORCE)
	set(LLVM_USE_CRT_RELWITHDEBINFO MT CACHE STRING "" FORCE)
	set(USE_MSVC_RUNTIME_LIBRARY_DLL OFF CACHE BOOL "")
endif()

if (BUILD_SHARED_LIBS)
	set(USE_MSVC_RUNTIME_LIBRARY_DLL ON CACHE BOOL "" FORCE)
	add_library(${LODEPNG_LIBRARIES} ${LODEPNG_SOURCES})
	target_compile_definitions(${LODEPNG_LIBRARIES} INTERFACE BUILD_SHARED_LIBS)
	set_target_properties(${LODEPNG_LIBRARIES} PROPERTIES POSITION_INDEPENDENT_CODE ON)
else()
	set(USE_MSVC_RUNTIME_LIBRARY_DLL OFF CACHE BOOL "" FORCE)
	add_library(${LODEPNG_LIBRARIES} STATIC ${LODEPNG_SOURCES})
endif()

set_target_properties(${LODEPNG_LIBRARIES} PROPERTIES RUNTIME_OUTPUT_NAME_DEBUG "lodepngd")

if(USE_SHARED_LIBS)
	set_target_properties(${LODEPNG_LIBRARIES} PROPERTIES FOLDER 3rdparty/Shared)
else()
	set_target_properties(${LODEPNG_LIBRARIES} PROPERTIES FOLDER 3rdparty/Static)
endif()

set_target_properties(${LODEPNG_LIBRARIES} PROPERTIES RUNTIME_OUTPUT_DIRECTORY "${FINAL_BIN_DIR}")
set_target_properties(${LODEPNG_LIBRARIES} PROPERTIES RUNTIME_OUTPUT_DIRECTORY_DEBUG "${FINAL_BIN_DIR}")
set_target_properties(${LODEPNG_LIBRARIES} PROPERTIES RUNTIME_OUTPUT_DIRECTORY_RELEASE "${FINAL_BIN_DIR}")

